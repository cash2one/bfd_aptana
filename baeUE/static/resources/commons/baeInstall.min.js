$(function(){$.ajaxSettings.traditional=!0;window.setInterval(function(){try{var a=window.parent.document.documentElement.clientHeight-101;$(window.parent.document).find("#function").height($("body").height()>a?$("body").height():a)}catch(f){}},20)});
$(function(){var a=navigator.userAgent.toLowerCase();(/.*chrome.*/.test(a)||/.*(safari).*/.test(a))&&setInterval(function(){$("table.grid").each(function(){var a=($(this).height()-$(this).find("tr:first").height())/$(this).find("tr:gt(0)").size();$(this).find("tr:gt(0)").attr("height",a)})},300)});
(function(){/(\w+\.html)/.test(window.location.href);var a=RegExp.$1,a=$(window.parent.document).find('.menulist a[href*="'+a+'"]');0<a.size()&&!a.hasClass("now")&&($(window.parent.document).find(".menulist a.now").removeClass("now"),a.addClass("now"))})();
(function(a){var f={init:function(f){function n(){this.setTitle=function(b){a(c.title.renderTo).html(b);window.parent.document.title=b};this.init=function(){a(c.title.renderTo).html(c.title.content);window.parent.document.title=c.title.content};this.init()}function o(){function b(a,b){a=parseDate(a,"Y-m-d").valueOf();b=parseDate(b,"Y-m-d").valueOf();return a===b?0:(b-a)/864E5}if(a.cookie("bae_date_range_begin")&&a.cookie("bae_date_range_end"))this.begin=a.cookie("bae_date_range_begin"),this.end=a.cookie("bae_date_range_end");
else{var d=new Date;d.setDate(d.getDate()-7);var g=new Date;g.setDate(g.getDate()-1);this.begin=formatDate(d,"Y-m-d");this.end=formatDate(g,"Y-m-d")}d=b(this.begin,this.end);this.dbBegin=parseDate(this.begin,"Y-m-d");this.dbBegin.setDate(this.dbBegin.getDate()-d-1);this.dbBegin=formatDate(this.dbBegin,"Y-m-d");this.dbEnd=parseDate(this.end,"Y-m-d");this.dbEnd.setDate(this.dbEnd.getDate()-d-1);this.dbEnd=formatDate(this.dbEnd,"Y-m-d");this.mode="single";a(".daydata .data").html(this.begin+"  \u81f3  "+
this.end);a(".tushi0:eq(0) span").html("\u5f53\u524d\u65f6\u95f4\u6bb5\uff08"+this.begin.replace("-",".")+"-"+this.end.replace("-",".")+"\uff09");a(".day_range > p  input:checkbox").attr("checked",!1);a(".day_range > div:eq(0)").baeDatePicker({date:[this.begin,this.end],lable:"\u9009\u62e9\u5f53\u524d\u65f6\u95f4:&nbsp;&nbsp;"});a(".day_range > div:eq(1)").baeDatePicker({date:[this.dbBegin,this.dbEnd],lable:"\u9009\u62e9\u5bf9\u6bd4\u65f6\u95f4:&nbsp;&nbsp;"});a(".day_range > div:eq(1)").hide();a(".day_range").hide();
a(".daydata > a").toggle(function(){a(".day_range").slideDown();a(c.chart.compareItem_renderTo).hide()},function(){a(".day_range").slideUp();a(c.chart.compareItem_renderTo).show()});a(".day_range > p  input:checkbox").change(a.proxy(function(){if(a(".day_range > p  input:checkbox").is(":checked")){var c=a(".day_range > div:eq(0)").baeDatePicker("getDate");c[0]=parseDate(c[0],"Y-m-d");c[1]=parseDate(c[1],"Y-m-d");var e=b(c[0],c[1]);c[0].setDate(c[0].getDate()-e-1);c[1].setDate(c[1].getDate()-e-1);
a(".day_range > div:eq(1)").baeDatePicker("setDate",formatDate(c[0],"Y-m-d"),formatDate(c[1],"Y-m-d"));a(".day_range > div:eq(1)").slideDown()}else a(".day_range > div:eq(1)").slideUp()},this));a(".day_range > p > button:eq(1)").click(function(){a(".daydata > a").click()});a(".day_range > p > button:eq(0)").click(a.proxy(function(){this.mode=a(".day_range > p  input:checkbox").is(":checked")?"compare":"single";this.begin=a(".day_range > div:eq(0)").baeDatePicker("getDate")[0];this.end=a(".day_range > div:eq(0)").baeDatePicker("getDate")[1];
this.dbBegin=a(".day_range > div:eq(1)").baeDatePicker("getDate")[0];this.dbEnd=a(".day_range > div:eq(1)").baeDatePicker("getDate")[1];if("compare"===this.mode){var b;b=[this.begin,this.end];var c=[this.dbBegin,this.dbEnd];b=[parseDate(b[0],"Y-m-d").valueOf(),parseDate(b[1],"Y-m-d").valueOf()];c=[parseDate(c[0],"Y-m-d").valueOf(),parseDate(c[1],"Y-m-d").valueOf()];b[1]-b[0]>c[1]-c[0]?b=[b[1]-(c[1]-c[0]),b[1]]:c=[c[1]-(b[1]-b[0]),c[1]];b=[[formatDate(new Date(b[0]),"Y-m-d"),formatDate(new Date(b[1]),
"Y-m-d")],[formatDate(new Date(c[0]),"Y-m-d"),formatDate(new Date(c[1]),"Y-m-d")]];if(this.begin!=b[0][0]||this.end!=b[0][1])this.begin=b[0][0],this.end=b[0][1],a(".day_range > div:eq(0)").baeDatePicker("setDate",this.begin,this.end);if(this.dbBegin!=b[1][0]||this.dbEnd!=b[1][1])this.dbBegin=b[1][0],this.dbEnd=b[1][1],a(".day_range > div:eq(1)").baeDatePicker("setDate",this.dbBegin,this.dbEnd)}a.cookie("bae_date_range_begin",this.begin,{path:"/"});a.cookie("bae_date_range_end",this.end,{path:"/"});
"single"===this.mode?(a(".contrastpic").hide(),a(".daydata .data").html(this.begin+"  \u81f3  "+this.end)):(a(".contrastpic").show(),a(".tushi0:eq(0) span").html("\u5f53\u524d\u65f6\u95f4\u6bb5\uff08"+this.begin.replace("-",".")+"-"+this.end.replace("-",".")+"\uff09"),a(".tushi0:eq(1) span").html("\u5bf9\u6bd4\u65f6\u95f4\u6bb5\uff08"+this.dbBegin.replace("-",".")+"-"+this.dbEnd.replace("-",".")+"\uff09"),a(".daydata .data").html(this.begin+" \u81f3 "+this.end+"  VS  "+this.dbBegin+" \u81f3 "+this.dbEnd));
a(".daydata > a").click();this.change([this.begin,this.end],[this.dbBegin,this.dbEnd])},this))}function p(){a.ajax({async:!1,url:c.menu.url,data:c.menu.data,dataType:"json",success:function(b){c.menu.parse(b);a(".r_tittle .menu > a:gt(0)").not(".now").each(function(){/(\w+\.html)/.test(a(this).attr("href"));var b=RegExp.$1,b=a(window.parent.document).find('.menulist a[href*="'+b+'"]');0<b.size()&&!b.hasClass("now")&&(a(window.parent.document).find(".menulist a.now").removeClass("now"),b.addClass("now"))})}})}
function q(){var b=this;b.currentItem={};var d=!0;this.load=function(b,d){var e;a.ajax({async:!1,url:c.menuItem.url,data:a.extend(c.menuItem.data,{begin:b,end:d}),dataType:"json",success:a.proxy(function(a){e=this.parse(a)},this)});return e};this.parse=function(c){var f=a("<tr></tr>");a.each(c,function(e,h){var d=100/c.length,j=a("<td></td>");j.css("width",d+"%");d=a("<div></div>").click(function(){if(!a(this).hasClass("groupnow")){a(".z").find("tr").find("div.groupnow").removeClass("groupnow").addClass("group");
var c=a(this).parent().index();a(".z").find("tr").find("td:eq("+c+") > div").addClass("groupnow");b.currentItem=h;b.change()}});!a.isEmptyObject(b.currentItem)&&b.currentItem.key===h.key?d.addClass("groupnow"):d.addClass("group");h.checked&&a.isEmptyObject(b.currentItem)?(b.currentItem=h,d.addClass("groupnow")):d.addClass("group");var m=a("<div></div>",{"class":"tittle",html:'<div class="txt">'+h.title+'</div><a class="ico" href="#"></a>'});m.find("a").qtip({content:h.desc,style:{name:"blue"},position:{corner:{target:"topMiddle",
tooltip:0==e?"leftBottom":e==c.length-1?"rightBottom":"bottomMiddle"}},style:{background:"#F0F5F9",color:"#999999",border:{color:"#267BB6"}}});var r=a("<div></div>",{"class":"value",text:h.value});e===c.length-1&&d.css("background-image","none");d.append(m).append(r).appendTo(j);j.appendTo(f)});b.items=c;d&&(d=!1,b.onInitLoad());b.onLoad();return f};this.flush=function(b){a(".z table").empty();a(".data01:eq(0) .z table").append(this.load(b.begin,b.end));"compare"===b.mode?(a(".data01_01").show(),
a(".data01:eq(1) .z table").append(this.load(b.dbBegin,b.dbEnd))):a(".data01_01").hide()}}function s(){var b=this;this.dom=a(c.chart.compareItem_renderTo);this.currentDbItem={};this.bindEvent=function(){a(c.chart.compareItem_renderTo).change(function(){b.change()})};this.flush=function(d,g){this.currentDbItem={};b.dom.find("option:gt(0)").remove();a.each(d,a.proxy(function(b,d){d.key!=g.key&&a("<option></option>",{value:d.key,text:d.title}).appendTo(c.chart.compareItem_renderTo)},this))};this.init=
function(){this.bindEvent()};this.init()}function t(b){this.flush=function(d,g){"map"!==c.chart.type?(a(".tushi:gt(0)").hide(),a(".tushi:even span").html(d.title),a.isEmptyObject(g)||a(".tushi:odd span").html(g.title),"compare"===b.mode&&a(".tushi:eq(2)").show(),a.isEmptyObject(g)||a(".tushi:eq(1)").show(),"compare"===b.mode&&!a.isEmptyObject(g)&&a(".tushi:eq(3)").show()):(a(".tushi").hide(),a(".tushi:eq(4)").show(),a(".tushi:eq(4)").find("span:first").html(d.title+":"))}}function u(b){function d(){var b=
[];e.find("input:checked").each(function(){b.push(a(this).val())});return b}function g(b){e.find("input").attr("checked",!1).each(function(){b.include(a(this).val())&&a(this).attr("checked",!0)})}var f=this;f.hideLabelInPieDom=a();a(c.grid.filterBtn);var e=a("<ul/>");this.getCols=function(){var b=[];b.push(c.grid.filter.fixColModel);c.grid.filter.fixColModels&&(b=b.concat(c.grid.filter.fixColModels));e.find("input:checked").each(function(){a.each(c.grid.filter.colModel,a.proxy(function(c,d){a(this).val()===
d.name&&b.push(d)},this))});return b};this.getDefaultCols=function(){var b=[];b.push(c.grid.filter.fixColModel);c.grid.filter.fixColModels&&(b=b.concat(c.grid.filter.fixColModels));a.each(c.grid.filter.defaultCols,function(d,e){a.each(c.grid.filter.colModel,a.proxy(function(a,c){e===c.name&&b.push(c)},this))});return b};this.resetOption=function(b){"list"===b?a(c.grid.filter.filterModeDom).find("a").eq(0).click():(e.find("input:checkbox").prop("checked",!1),e.find("input:checkbox").eq(0).prop("checked",
!0),a(c.grid.filter.filterModeDom).find("a.now").removeClass("now"))};this.flush=function(){e.empty();a.each(c.grid.filter.colModel,function(g,l){var j=a("<li/>").appendTo(e);l.hideInPie&&(f.hideLabelInPieDom=f.hideLabelInPieDom.add(j));var m=a("<input/>",{type:"checkbox",value:l.name}).attr("checked",c.grid.filter.defaultCols.include(l.name)?!0:!1).click(function(){if(b.model==="list"){if(a(this).is(":checked")&&e.find("input:checkbox:checked").size()===7){alert("\u6700\u591a\u9009\u62e96\u9879\u6307\u6807");
return false}if(e.find("input:checkbox:checked").size()===0){alert("\u6700\u5c11\u4fdd\u75591\u4e2a\u6307\u6807");return false}a(c.grid.filter.filterModeDom).find("a").removeClass("now");c.grid.filter.defaultCols.equal(d())?a(c.grid.filter.filterModeDom).find("a:eq(0)").addClass("now"):c.grid.filter.orderCols.equal(d())?a(c.grid.filter.filterModeDom).find("a:eq(1)").addClass("now"):c.grid.filter.goodsCols.equal(d())&&a(c.grid.filter.filterModeDom).find("a:eq(2)").addClass("now")}else if(this.checked){e.find("input:checkbox:checked").attr("checked",
false);a(this).prop("checked",true)}else{alert("\u6700\u5c11\u4fdd\u75591\u4e2a\u6307\u6807");return false}});a("<label/>",{text:l.colName}).appendTo(j).prepend(m)});e.appendTo(c.grid.filter.filterListRenderTo)};this.init=function(){c.grid.filter.fixColModel.sortable=!1;c.grid.filter.fixColModels&&a.each(c.grid.filter.fixColModels,function(a,b){b.sortable=!1});a(c.grid.filter.filterModeDom).find("a").each(function(b){a(this).click(function(){a(this).hasClass("now")||(a(c.grid.filter.filterModeDom).find("a").removeClass("now"),
a(this).addClass("now"),0===b?g(c.grid.filter.defaultCols):1===b?g(c.grid.filter.orderCols):g(c.grid.filter.goodsCols))})});this.flush();a(c.grid.filter.changeFilterBtn).click(function(){f.change();a(c.grid.filter.listFilterBtn).click()})};this.init()}function v(){var b=this,d=a(c.grid.filter.modelBtn);this.model="list";d.toggle(a.proxy(function(){a(".ud_select .select .txt").hide();d.html("\u6570\u636e\u62a5\u8868\u6a21\u5f0f");d.addClass("b_data");this.model="pie";b.change()},this),a.proxy(function(){a(".ud_select .select .txt").show();
d.html("\u997c\u56fe\u6a21\u5f0f");d.removeClass("b_data");this.model="list";b.change()},this))}function w(b,d,f){this.fixColModel=[];this.flush=function(i){var e=a.extend(!0,{},c.grid.grid,{colModel:d.getCols()},{data:{begin:b.begin,end:b.end}});i&&(e.colModel=d.getDefaultCols());var h=d.getCols();"compare"===b.mode&&"pie"!==f.model&&(e.data.dbBegin=b.dbBegin,e.data.dbEnd=b.dbEnd,e.data.groupCol=h[0].name,e.data.tansact="dateRange");"pie"===f.model&&(e.colModel.push({colName:"\u5360\u6bd4",name:"scale",
sortable:!1}),e.data.colName=h[h.length-1].name,e.onDataLoad=function(b){b.countCol&&a("body").data("countCol",b.countCol.toString());a.each(b.stores,function(b,c){c.scale=(parseFloat(c[e.data.colName].toString().replace(/,/g,"").replace("\uffe5",""))*100/parseFloat(a("body").data("countCol"))).toFixed(2)+"%"})},e.fixColModel=[{colName:"\u997c\u56fe",name:"pie",render:function(b,c){b.css({"vertical-align":"top","min-width":"500px"});var d=[],e=0;a.each(c,function(b,a){if(b>9)return false;var c=parseFloat(a.scale.replace("%",
""));d.push({name:a[h[0].name],y:c});console.info(a[h[0].name]+":"+c);e=e+c});e<100&&d.push({name:"\u5176\u4ed6",y:100-e});new Highcharts.Chart({chart:{renderTo:b[0],plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false},credits:{enabled:false},title:{text:null},tooltip:{formatter:function(){return this.point.name+"<br/> <b>"+this.y+" %</b>"}},plotOptions:{pie:{size:"50%",cursor:"pointer",dataLabels:{enabled:true,formatter:function(){return this.point.name+"<br/> <b>"+this.y+" %</b>"}}}},
series:[{type:"pie",name:"",data:d}]})}}]);a.baeGrid(e)};this.init=function(){a.baeGrid(a.extend(!0,{},c.grid.grid,{colModel:d.getCols()},{data:{begin:b.begin,end:b.end}}))};this.init()}function x(b){this.flush=function(){var d=c.report.url+"?"+encodeURI(a.param(a.extend({},c.report.data,{begin:b.begin,end:b.end})));a(".bb_down").attr("href",d)};this.flush()}var k={title:{renderTo:"h1 span:eq(0)"},dataRange:{renderTo:".daydata .data"},menu:{parse:function(b){a.each(b,function(b,c){var f=a("<a></a>",
{text:c.title});c.checked?f.addClass("now"):f.attr("href",c.url);f.appendTo(".menu")})}},menuItem:{},chart:{type:"line",compareItem_renderTo:".data_select select:eq(0)",renderTo:".tubiao",width:"100%",hight:380},grid:{grid:{renderTo:"#grid",agv_width:!0,beforeColSetVal:[],page:{renderTo:".pager",rowList:[20,50,100,200]}},filter:{modelBtn:"#girdModel",filterListRenderTo:".ud_select div:eq(0)",colModel:[{colName:"\u552f\u4e00\u8bbf\u5ba2\u6570",name:"UV"},{colName:"\u9875\u9762\u6d4f\u89c8\u6570",name:"PV"},
{colName:"\u65b0\u8bbf\u6b21\u6570",name:"F0"},{colName:"\u6bcf\u6b21\u8bbf\u95ee\u9875\u6570",name:"F1"},{colName:"\u5e73\u5747\u7f51\u7ad9\u8bbf\u95ee\u65f6\u957f",name:"F2"},{colName:"\u65b0\u8bbf\u5360\u6bd4",name:"F3",hideInPie:!0},{colName:"\u8bbf\u6b21",name:"F4"},{colName:"\u7f51\u7ad9\u8df3\u51fa\u7387",name:"F5",hideInPie:!0},{colName:"\u4e0b\u5b9a\u5546\u54c1\u6570\u91cf",name:"F6"},{colName:"\u4e0b\u5b9a\u5546\u54c1\u91d1\u989d",name:"F7"},{colName:"\u4e0b\u5b9a\u8ba2\u5355\u6570\u91cf",
name:"F8"},{colName:"\u4e0b\u5b9a\u8ba2\u5355\u91d1\u989d",name:"F9"},{colName:"\u4e0b\u5b9a\u8ba2\u5355\u8f6c\u5316\u7387",name:"F10",hideInPie:!0}],defaultCols:"UV PV F5 F1 F8 F10".split(" "),orderCols:"UV PV F5 F8 F9 F10".split(" "),goodsCols:["UV","PV","F5","F6","F7"],listFilterBtn:".data03 > .top > .userdata",changeFilterBtn:".ud_select .select div:eq(1)",filterDom:".ud_select",filterModeDom:".ud_select .select .txt",cancellistFilterBtn:".ud_select .select div:eq(0)"}}};f.grid.filter.defaultCols&&
delete k.grid.filter.defaultCols;f.grid.filter.orderCols&&delete k.grid.filter.orderCols;f.grid.filter.goodsCols&&delete k.grid.filter.goodsCols;f.grid.filter.colModel&&delete k.grid.filter.colModel;var c=a.extend(!0,k,f);a(c.grid.filter.filterDom).hide();a(c.grid.filter.listFilterBtn).click(function(){a(c.grid.filter.filterDom).slideToggle()});a(c.grid.filter.cancellistFilterBtn).click(function(){a(c.grid.filter.listFilterBtn).click()});(new function(){var b=this;this.install=function(){c.expand&&
c.expand.call(b,c);b.title=new n;b.dateRange=new o;c.hideMenu||(b.menu=new p);b.menuItem=new q;b.menuItemCompare=new s;b.chartLegend=new t(b.dateRange);b.menuItem.onInitLoad=function(){b.menuItemCompare.flush(b.menuItem.items,b.menuItem.currentItem)};b.menuItem.onLoad=function(){b.chartLegend.flush(b.menuItem.currentItem,b.menuItemCompare.currentDbItem)};b.menuItem.flush(b.dateRange);b.menuItem.change=function(){b.menuItemCompare.flush(b.menuItem.items,b.menuItem.currentItem);b.chartLegend.flush(b.menuItem.currentItem,
b.menuItemCompare.currentDbItem);b.chart.flush()};b.menuItemCompare.change=function(){this.dom.val()===this.dom.find("option:first").val()?this.currentDbItem={}:a.each(b.menuItem.items,a.proxy(function(b,a){if(this.dom.val()===a.key)this.currentDbItem=a},b.menuItemCompare));b.chartLegend.flush(b.menuItem.currentItem,b.menuItemCompare.currentDbItem);b.chart.flush()};b.chart=new Chart(b.dateRange,b.menuItem,b.menuItemCompare,c);b.toggle=new v;b.filter=new u(b.toggle);b.grid=new w(b.dateRange,b.filter,
b.toggle);b.toggle.change=function(){if(b.toggle.model=="pie"){b.filter.hideLabelInPieDom.hide();b.filter.resetOption("pie")}else{b.filter.hideLabelInPieDom.show();b.filter.resetOption("list")}b.grid.flush()};b.filter.change=function(){b.grid.flush()};c.report&&(b.report=new x(b.dateRange));b.dateRange.change=function(){b.menuItem.flush(b.dateRange);b.chart.flush();b.grid.flush();c.report&&b.report.flush()}}}).install()}};a.baeInstall=function(i){if(f[i])return f[i].apply(this,Array.prototype.slice.call(arguments,
1));if("object"===typeof i||!i)return f.init.apply(this,arguments);a.error("Method "+i+" does not exist on jQuery.baeInstall")}})(jQuery);Array.prototype.equal=function(a){if(!a||!this||this.length!==a.length)return!1;for(var f in this)if(this[f]!==a[f])return!1;return!0};Array.prototype.include=function(a){for(var f=0;f<this.length;f++)if(this[f]===a)return!0;return!1};
